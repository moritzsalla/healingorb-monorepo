{"version":3,"sources":["background/sensehat.ts","background/background.ts"],"names":[],"mappings":";AAiCA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAjCA,IAAA,EAAA,WAIE,SAAA,EAAY,EAAiB,GACtB,KAAA,QAAU,EACV,KAAA,SAAW,EAAS,QAAU,OAyBvC,OAtBE,EAAA,UAAA,SAAA,SAAS,EAAW,EAAW,GACzB,IAAA,EAAO,IAAI,eACf,EAAK,KACH,MACG,KAAK,SAAQ,MAAM,KAAK,QAAO,YAAY,KAAK,MACjD,GACD,MAAM,KAAK,MAAM,GAAE,MAAM,KAAK,MAAM,IAEvC,EAAK,QAGP,EAAA,UAAA,MAAA,WACM,IAAA,EAAO,IAAI,eACf,EAAK,KAAK,MAAU,KAAK,SAAQ,MAAM,KAAK,QAAO,UACnD,EAAK,QAGP,EAAA,UAAA,KAAA,WACM,IAAA,EAAO,IAAI,eACf,EAAK,KAAK,MAAU,KAAK,SAAQ,MAAM,KAAK,QAAO,SACnD,EAAK,QAET,EA/BA,GAiCA,QAAA,QAAe;;AC0Fd,aAAA,IAAA,EAAA,MAAA,KAAA,iBAAA,SAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,IAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IA3HD,IAAA,EAAA,EAAA,QAAA,2BAEA,OAAO,QAAQ,YAAY,YAAY,WACrC,OAAO,mBAAmB,cAAc,iBAAY,EAAW,WAC7D,OAAO,mBAAmB,cAAc,SAAS,CAC/C,CACE,WAAY,CACV,IAAI,OAAO,mBAAmB,iBAAiB,CAC7C,QAAS,CAEP,QAAS,CAAC,OAAQ,aAIxB,QAAS,CAAC,IAAI,OAAO,mBAAmB,uBAMhD,IAAM,EAAQ,IAAI,EAAA,QAAS,gBAAgB,GASvC,EAAI,EACJ,EAAS,KAET,EAAU,EACV,EAAU,EACV,EAAU,EAEV,EAAM,CACR,IAAK,CAAE,EAAG,IAAK,EAAG,EAAG,EAAG,GACxB,IAAK,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,IAkE1B,SAAS,EACP,EACA,EACA,EACA,EACA,GAEO,OAAA,GAA8B,EAAQ,IAAW,EAAQ,IAA/C,EAAQ,GAG3B,SAAS,EAAU,GACb,MAAM,GACR,QAAQ,MAAM,EAAI,qBAGhB,EAAI,GAAK,EAAI,MACf,QAAQ,MAAM,EAAI,uBA/EtB,OAAO,QAAQ,MAAM,IAAI,CAAE,MAAO,IAClC,OAAO,QAAQ,UAAU,YAAY,SAAU,GACzC,EAAU,QAAO,EAAM,EAAU,MAAM,YAI7C,YAAY,WACV,OAAO,QAAQ,MAAM,IAAI,CAAC,SAAU,SAAC,GAG/B,GAAA,EAAO,MAAM,cAAgB,OAAS,EAAO,MAAM,OAFzC,GAE2D,CAIlE,IAFD,IAAA,EAAM,EAED,EAAI,EAAG,GANJ,GAMkB,IAC5B,GAAO,EAAO,MAAM,EAAO,MAAM,OAAS,GAC1C,QAAQ,IACN,SAAW,EAAI,KAAO,EAAO,MAAM,EAAO,MAAM,OAAS,IAG7D,GAZY,GAcZ,QAAQ,IAAI,YAAc,GAI1B,IADW,EAAM,GACL,EAGJ,IAAA,EAAa,EAAG,IAAX,EAAQ,EAAG,IACpB,EAAO,KAAK,MAAM,EAAI,EAAG,EAAG,EAAG,EAAI,EAAG,EAAI,IAC1C,EAAO,KAAK,MAAM,EAAI,EAAG,EAAG,EAAG,EAAI,EAAG,EAAI,IAC1C,EAAO,KAAK,MAAM,EAAI,EAAG,EAAG,EAAG,EAAI,EAAG,EAAI,IAG1C,EAAO,IAAG,EAAO,GACjB,EAAO,IAAG,EAAO,GACjB,EAAO,IAAG,EAAO,GAGjB,IAAY,GAAQ,IAAY,GAAQ,IAAY,GAEtD,EAAM,SAAS,EAAM,EAAM,GAG7B,EAAU,EACV,EAAU,EACV,EAAU,EAGV,EAAU,GACV,EAAU,GACV,EAAU,OAGb","file":"background.js","sourceRoot":"../src","sourcesContent":["class SenseHat {\n  address: string;\n  protocol: string;\n\n  constructor(address: string, secure: boolean) {\n    this.address = address;\n    this.protocol = secure ? \"https\" : \"http\";\n  }\n\n  setColor(r: number, g: number, b: number) {\n    let http = new XMLHttpRequest();\n    http.open(\n      \"GET\",\n      `${this.protocol}://${this.address}/color?r=${Math.round(\n        r\n      )}&g=${Math.round(g)}&b=${Math.round(b)}`\n    );\n    http.send();\n  }\n\n  clear() {\n    let http = new XMLHttpRequest();\n    http.open(\"GET\", `${this.protocol}://${this.address}/clear`);\n    http.send();\n  }\n\n  test() {\n    let http = new XMLHttpRequest();\n    http.open(\"GET\", `${this.protocol}://${this.address}/test`);\n    http.send();\n  }\n}\n\nexport default SenseHat;\n","import SenseHat from \"../background/sensehat\";\n\nchrome.runtime.onInstalled.addListener(function () {\n  chrome.declarativeContent.onPageChanged.removeRules(undefined, function () {\n    chrome.declarativeContent.onPageChanged.addRules([\n      {\n        conditions: [\n          new chrome.declarativeContent.PageStateMatcher({\n            pageUrl: {\n              // hostEquals:\n              schemes: [\"http\", \"https\"],\n            },\n          }),\n        ],\n        actions: [new chrome.declarativeContent.ShowPageAction()],\n      },\n    ]);\n  });\n});\n\nconst Sense = new SenseHat(\"192.168.0.24\", true);\n\n/*\n********\ninit animation loop\nand do smth with sensehat\n********\n*/\n\nlet c = 1;\nlet easing = 0.005;\n\nlet oldOutR = 0;\nlet oldOutG = 0;\nlet oldOutB = 0;\n\nlet col = {\n  min: { r: 255, g: 0, b: 0 },\n  max: { r: 0, g: 255, b: 0 },\n};\n\nchrome.storage.local.set({ color: col });\nchrome.storage.onChanged.addListener(function (namespace) {\n  if (namespace.color) col = namespace.color.newValue;\n});\n\n// create animation loop to animate sensehat\nsetInterval(function () {\n  chrome.storage.local.get([\"score\"], (result) => {\n    let history = 10;\n\n    if (result.score.constructor === Array && result.score.length > history) {\n      // calculate avg from last 10 entries\n      let val = 0;\n\n      for (let i = 1; i <= history; i++) {\n        val += result.score[result.score.length - i];\n        console.log(\n          \"value \" + i + \": \" + result.score[result.score.length - i]\n        );\n      }\n      val /= history;\n\n      console.log(\"average: \" + val);\n\n      // easing\n      let dist = val - c;\n      c += dist * easing;\n\n      // map normalized color vals to rgb range: 0-255\n      const { min, max } = col;\n      let outR = Math.round(map(c, 0, 1, min.r, max.r));\n      let outG = Math.round(map(c, 0, 1, min.g, max.g));\n      let outB = Math.round(map(c, 0, 1, min.b, max.b));\n\n      // sensehat doesnt display colors under val of 8\n      if (outR < 8) outR = 8;\n      if (outG < 8) outG = 8;\n      if (outB < 8) outB = 8;\n\n      // send to sensehat only when vals update\n      if (oldOutR !== outR && oldOutG !== outG && oldOutB !== outB) {\n        // console.log(outR, outG, outB);\n        Sense.setColor(outR, outG, outB);\n      }\n\n      oldOutR = outR;\n      oldOutG = outR;\n      oldOutB = outR;\n\n      // tests\n      colorTest(outR);\n      colorTest(outG);\n      colorTest(outB);\n    }\n  });\n}, 500);\n\n/*\n********\nhelper functions\n********\n*/\n\nfunction map(\n  value: number,\n  start1: number,\n  stop1: number,\n  start2: number,\n  stop2: number\n): number {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfunction colorTest(c: number): void {\n  if (isNaN(c)) {\n    console.error(c + \" is not a number\");\n    return;\n  }\n  if (c < 0 || c > 255) {\n    console.error(c + \" not in range 0â€“255\");\n    return;\n  }\n}\n"]}